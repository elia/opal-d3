<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Olympics 2016 Medals</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">
  <link rel="stylesheet" href="assets/style.css">
  <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css' rel='stylesheet'/>
  <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js'></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
  <div class="container">
    <h1>Olympics 2016 Medals</h1>
    <div id="visualization"></div>
    <div id="code">
      <h1>Code</h1>
      <pre><code>require "opal"
require "opal-d3"
require "data/olympics_2016_medals"

height = Olympics2016Medals.size * 24
svg = D3.select("#visualization")
        .append("svg")
        .attr("height", "#{height}px")
        .attr("width", "100%")

width = svg.style("width").to_i
max_medals = Olympics2016Medals.map(&:total).max

x = D3.scale_linear.domain([0, max_medals]).range([0, width-50])
y = D3.scale_linear.domain([0, Olympics2016Medals.size]).range([0, height])

svg.append("g").attr("transform", "translate(50, 0)")
  .select_all("rect")
  .data(Olympics2016Medals)
  .enter.append("rect")
    .attr("height", 20)
    .attr("width"){|d| x.(d.gold)}
    .attr("x", 0)
    .attr("y"){|d,i| y.(i)}
    .attr("fill", "gold")

svg.append("g").attr("transform", "translate(50, 0)")
  .select_all("rect")
  .data(Olympics2016Medals)
  .enter.append("rect")
    .attr("height", 20)
    .attr("width"){|d| x.(d.silver)}
    .attr("x"){|d| x.(d.gold) }
    .attr("y"){|d,i| y.(i)}
    .attr("fill", "silver")

svg.append("g").attr("transform", "translate(50, 0)")
  .select_all("rect")
  .data(Olympics2016Medals)
  .enter.append("rect")
    .attr("height", 20)
    .attr("width"){|d| x.(d.bronze)}
    .attr("x"){|d| x.(d.gold + d.silver) }
    .attr("y"){|d,i| y.(i)}
    .attr("fill", "#CD7F32")

svg.append("g")
  .select_all("text")
  .data(Olympics2016Medals)
  .enter.append("text")
    .attr("x", 0)
    .attr("y"){|d,i| y.(i) + 16}
    .text{|d| d.acronym}
    .style("font-size", "20px")
</code></pre>
    </div>
    <script src="../assets/d3.js"></script>
    <script src="../assets/olympics_2016_medals.js"></script>
    <script>
      window.onload = function() { Opal.load("olympics_2016_medals"); }
    </script>
  </div>
</body>
</html>
